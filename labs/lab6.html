<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.33">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2025-10-15">

<title>lab6 – E155 portfolio</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-bc185b5c5bdbcb35c2eb49d8a876ef70.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-42c556fe1a289823da7f919bab4d1b2a.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">E155 portfolio</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../blog.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-labs" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Labs</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-labs">    
        <li>
    <a class="dropdown-item" href="../labs/lab1.html">
 <span class="dropdown-text">Lab1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../labs/lab2.html">
 <span class="dropdown-text">Lab2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../labs/lab3.html">
 <span class="dropdown-text">Lab3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../labs/lab4.html">
 <span class="dropdown-text">Lab4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../labs/lab5.html">
 <span class="dropdown-text">Lab5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../labs/lab6.html">
 <span class="dropdown-text">Lab6</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../labs/lab7.html">
 <span class="dropdown-text">Lab7</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../project.html"> 
<span class="menu-text">Project Proposal</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../resources.html"> 
<span class="menu-text">Resources</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#lab-6---the-internet-of-things-and-serial-peripheral-interface" id="toc-lab-6---the-internet-of-things-and-serial-peripheral-interface" class="nav-link active" data-scroll-target="#lab-6---the-internet-of-things-and-serial-peripheral-interface">Lab 6 - The Internet of Things and Serial Peripheral Interface</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#technical-documentation" id="toc-technical-documentation" class="nav-link" data-scroll-target="#technical-documentation">Technical Documentation</a>
  <ul class="collapse">
  <li><a href="#equations" id="toc-equations" class="nav-link" data-scroll-target="#equations">Equations</a></li>
  <li><a href="#example-ds1722-register-address" id="toc-example-ds1722-register-address" class="nav-link" data-scroll-target="#example-ds1722-register-address">Example DS1722 Register Address</a></li>
  </ul></li>
  <li><a href="#results-and-discussion" id="toc-results-and-discussion" class="nav-link" data-scroll-target="#results-and-discussion">Results and Discussion</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  <li><a href="#suggestions" id="toc-suggestions" class="nav-link" data-scroll-target="#suggestions">Suggestions</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
  <div class="quarto-categories">
    <div class="quarto-category">labreport</div>
  </div>
  </div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 15, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="lab-6---the-internet-of-things-and-serial-peripheral-interface" class="level2">
<h2 class="anchored" data-anchor-id="lab-6---the-internet-of-things-and-serial-peripheral-interface">Lab 6 - The Internet of Things and Serial Peripheral Interface</h2>
</section>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>In this lab, a design was made to use a microcontroller, the SPI interface, and the UART interface to build and design an IoT device. One first part of this design incorporated an SPI link between the microcontroller and a DS1722 temperature sensor. This link was written over the peripherals, MISO, MOSI, CE, and SYSCLK. The next part was an UART connection between the microcontroller and a ESP8266 wifi module. The wifi module would output the temperature values and the resolution coming from the microcontroller. As the final part of the design, a website was created within the microcontroller to output the temperature values and the user is able to control the temperture resolution, and an onboard LED.</p>
<p>The design was developed using C on SEGGER, and implemented on an STM32L432KC Microcontroller.</p>
</section>
<section id="technical-documentation" class="level2">
<h2 class="anchored" data-anchor-id="technical-documentation">Technical Documentation</h2>
<p>The source code for this lab can be found in this <a href="https://github.com/Swayngee/e155-lab1/tree/main/fpga/src/lab6">GitHub repo</a>.</p>
<p>The documentation for the STM32L432KC manual <a href="https://hmc-e155.github.io/assets/doc/rm0394-stm32l41xxx42xxx43xxx44xxx45xxx46xxx-advanced-armbased-32bit-mcus-stmicroelectronics.pdf">Github link</a>.</p>
<p>The documentation for the DS1722 <a href="https://hmc-e155.github.io/assets/doc/ds1722.pdf">Github link</a>.</p>
<p>The documentation for the ESP8266 <a href="https://github.com/HMC-E155/tutorial-esp8266-click-webserver">Github repo</a>.</p>
<section id="equations" class="level3">
<h3 class="anchored" data-anchor-id="equations">Equations</h3>
<p>There were no equations used for this lab.</p>
</section>
<section id="example-ds1722-register-address" class="level3">
<h3 class="anchored" data-anchor-id="example-ds1722-register-address">Example DS1722 Register Address</h3>
<p>To be able to control the resolution of the tempertaure sensor, the user must look at the datasheet and write and read from the correct registers. Along with this, Proper modes and enabling bits also need to be written to ensure synchronization.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../images/Registeradd.png" class="img-fluid figure-img"></p>
<figcaption>Figure 1: Below is the register map for the DS1722</figcaption>
</figure>
</div>
<section id="logic-analyzer" class="level4">
<h4 class="anchored" data-anchor-id="logic-analyzer">Logic Analyzer</h4>
<p>This overall design was tested using the Logic Analyzer option on an Oscilliscope. This function performs the same as the FPGA waveforms that we have seen in previous labs. It portrays all essential parts of the SPI protocol, which include the clock, enabler, MISO and MOSI.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../images/DS1Z_QuickPrint2.png" class="img-fluid figure-img"></p>
<figcaption>Figure 2: Above is the Logic Analyzer for this design</figcaption>
</figure>
</div>
<p>Above are clearly shown the enabler(D9), the clock(D10), MISO(D11), and MOSI(D12). On the bottom we can see the clear outputs from the MOSI and MISO. On the MISO wave, first see the sensor waiting for an input read/write. Once this first instruction is sent from MOSI (226), which is the starting resolution, we see dont see an output in MISO because we are writing. However once we read the LSB and MSB registers as shown in MOSI, the MISO changes accordingly to show the output value of 24.218, which is around what we expected around room temperature.</p>
<p><strong>Wiring Schematic</strong></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../images/schematiclab6.jpg" class="img-fluid figure-img"></p>
<figcaption>Figure 4: This schematic shows the wiring and components between our dev board, the ESP8266, the DS1722, and the onboard LED</figcaption>
</figure>
</div>
<p>Above pictures the electrical circuit for our design. It portrays resistors, and all other electrical components used for the design.</p>
</section>
</section>
</section>
<section id="results-and-discussion" class="level2">
<h2 class="anchored" data-anchor-id="results-and-discussion">Results and Discussion</h2>
<p><strong>Printed Temperature Values</strong></p>
<p>For this lab, a website was created to be able to toggle an LED on and off, and control the resolution of a tempertaure sensor, the output of the seen can be seen below.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../images/lab6wp.png" class="img-fluid figure-img"></p>
<figcaption>Figure 3: Below is an example of the output from the website</figcaption>
</figure>
</div>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>The design was a success. The microcontroller successfully was linked via SPI to the DS1722, and via UART to the ESP8266. Along with this, a webiste was created successfully to read the temperature values over wifi from the ESP8266, and the user was able to change and control a LED, and the resolution of the temperature sensor.</p>
<p>This Lab took 12 hours.</p>
</section>
<section id="suggestions" class="level2">
<h2 class="anchored" data-anchor-id="suggestions">Suggestions</h2>
<p>To, in future labs, better understand the SPI interface beforehand and understand how it compares to other communication protocols such as I2C or I2S.</p>
<p>This lab took me 15 hours. ## Ai prototype Here is the AI prototype for this lab. Posted below is the prompt that was plugged into Claude AI: 1. I’m making a web portal to interface with a temperature sensor. Create a HTML page that looks good and is intuitive to show the temperature, control an LED, and change the precision of the readout.</p>
<p>Below is the output from the LLM.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../images/claude.png" class="img-fluid figure-img"></p>
<figcaption>Figure 5: HDML website created by Claude</figcaption>
</figure>
</div>
<p>The LLM did not output any code.</p>
<ol start="2" type="1">
<li>Write me a C function to carry out a SPI transaction to retrieve a temperature reading from a DS1722 sensor. Make use of CMSIS libraries for the STM32L432KC.</li>
</ol>
<p>Output code:</p>
<p>/** * DS1722 Temperature Sensor SPI Driver for STM32L432KC * Using CMSIS libraries */</p>
<p>#include “stm32l4xx.h” #include &lt;stdint.h&gt;</p>
<p>// DS1722 Register Addresses #define DS1722_REG_CONFIG 0x80 #define DS1722_REG_TEMP_LSB 0x01 #define DS1722_REG_TEMP_MSB 0x02</p>
<p>// DS1722 Configuration bits #define DS1722_CONFIG_SHUTDOWN 0x01 #define DS1722_CONFIG_ONESHOT 0x10 #define DS1722_CONFIG_RES_8BIT 0x00 #define DS1722_CONFIG_RES_9BIT 0x02 #define DS1722_CONFIG_RES_10BIT 0x04 #define DS1722_CONFIG_RES_11BIT 0x06 #define DS1722_CONFIG_RES_12BIT 0x08</p>
<p>// GPIO Configuration (adjust pins as needed) #define SPI_CS_PIN 4 // PA4 for CS #define SPI_SCK_PIN 5 // PA5 for SCK #define SPI_MISO_PIN 6 // PA6 for MISO #define SPI_MOSI_PIN 7 // PA7 for MOSI</p>
<p>/** * Initialize SPI1 peripheral for DS1722 communication * Assumes system clock is already configured */ void DS1722_SPI_Init(void) { // Enable clocks for GPIOA and SPI1 RCC-&gt;AHB2ENR |= RCC_AHB2ENR_GPIOAEN; RCC-&gt;APB2ENR |= RCC_APB2ENR_SPI1EN;</p>
<pre><code>// Configure GPIO pins for SPI1 (PA5=SCK, PA6=MISO, PA7=MOSI)
// Set alternate function mode (AF5 for SPI1)
GPIOA-&gt;MODER &amp;= ~(GPIO_MODER_MODE5 | GPIO_MODER_MODE6 | GPIO_MODER_MODE7);
GPIOA-&gt;MODER |= (GPIO_MODER_MODE5_1 | GPIO_MODER_MODE6_1 | GPIO_MODER_MODE7_1);

// Set alternate function AF5 (SPI1) for PA5, PA6, PA7
GPIOA-&gt;AFR[0] &amp;= ~(GPIO_AFRL_AFSEL5 | GPIO_AFRL_AFSEL6 | GPIO_AFRL_AFSEL7);
GPIOA-&gt;AFR[0] |= (5 &lt;&lt; GPIO_AFRL_AFSEL5_Pos) | 
                 (5 &lt;&lt; GPIO_AFRL_AFSEL6_Pos) | 
                 (5 &lt;&lt; GPIO_AFRL_AFSEL7_Pos);

// Set high speed for SPI pins
GPIOA-&gt;OSPEEDR |= (GPIO_OSPEEDR_OSPEED5 | GPIO_OSPEEDR_OSPEED6 | GPIO_OSPEEDR_OSPEED7);

// Configure PA4 as CS (Chip Select) - output, push-pull
GPIOA-&gt;MODER &amp;= ~GPIO_MODER_MODE4;
GPIOA-&gt;MODER |= GPIO_MODER_MODE4_0;
GPIOA-&gt;OTYPER &amp;= ~GPIO_OTYPER_OT4;
GPIOA-&gt;OSPEEDR |= GPIO_OSPEEDR_OSPEED4;

// Set CS high (inactive)
GPIOA-&gt;BSRR = (1 &lt;&lt; SPI_CS_PIN);

// Configure SPI1
// Disable SPI for configuration
SPI1-&gt;CR1 &amp;= ~SPI_CR1_SPE;

// Configure SPI: Master mode, CPOL=0, CPHA=0, 8-bit data
// Baud rate: fPCLK/16 (assuming 80MHz PCLK, this gives ~5MHz SPI clock)
SPI1-&gt;CR1 = SPI_CR1_MSTR |           // Master mode
            SPI_CR1_SSM |             // Software slave management
            SPI_CR1_SSI |             // Internal slave select
            (3 &lt;&lt; SPI_CR1_BR_Pos);    // Baud rate: fPCLK/16

SPI1-&gt;CR2 = (7 &lt;&lt; SPI_CR2_DS_Pos) |  // 8-bit data size
            SPI_CR2_FRXTH;            // RXFIFO threshold

// Enable SPI
SPI1-&gt;CR1 |= SPI_CR1_SPE;</code></pre>
<p>}</p>
<p>/** * Send/receive a single byte via SPI */ static uint8_t SPI_TransferByte(uint8_t data) { // Wait until TX buffer is empty while (!(SPI1-&gt;SR &amp; SPI_SR_TXE));</p>
<pre><code>// Send data
*(__IO uint8_t *)&amp;SPI1-&gt;DR = data;

// Wait until RX buffer has data
while (!(SPI1-&gt;SR &amp; SPI_SR_RXNE));

// Read and return received data
return *(__IO uint8_t *)&amp;SPI1-&gt;DR;</code></pre>
<p>}</p>
<p>/** * Assert CS (Chip Select) - pull low */ static inline void DS1722_CS_Low(void) { GPIOA-&gt;BSRR = (1 &lt;&lt; (SPI_CS_PIN + 16)); // Reset bit }</p>
<p>/** * Deassert CS (Chip Select) - pull high */ static inline void DS1722_CS_High(void) { GPIOA-&gt;BSRR = (1 &lt;&lt; SPI_CS_PIN); // Set bit }</p>
<p>/** * Write to DS1722 register */ void DS1722_WriteRegister(uint8_t reg, uint8_t value) { DS1722_CS_Low(); SPI_TransferByte(reg); // Send register address SPI_TransferByte(value); // Send data DS1722_CS_High(); }</p>
<p>/** * Read from DS1722 register */ uint8_t DS1722_ReadRegister(uint8_t reg) { uint8_t value;</p>
<pre><code>DS1722_CS_Low();
SPI_TransferByte(reg);          // Send register address
value = SPI_TransferByte(0x00); // Dummy byte to read data
DS1722_CS_High();

return value;</code></pre>
<p>}</p>
<p>/** * Configure DS1722 sensor * resolution: DS1722_CONFIG_RES_8BIT to DS1722_CONFIG_RES_12BIT */ void DS1722_Configure(uint8_t resolution) { // Write configuration: continuous conversion mode with specified resolution DS1722_WriteRegister(DS1722_REG_CONFIG, resolution); }</p>
<p>/** * Simple delay function (approximate, not precise) <em>/ static void delay_ms(uint32_t ms) { // Assumes 80MHz system clock, adjust as needed for (uint32_t i = 0; i &lt; ms </em> 8000; i++) { __NOP(); } }</p>
<p>/** * Read temperature from DS1722 sensor * Returns temperature in degrees Celsius as a float * * The DS1722 stores temperature in two registers: * - MSB: Integer part (signed) * - LSB: Fractional part (upper bits) */ float DS1722_ReadTemperature(void) { int8_t temp_msb; uint8_t temp_lsb; float temperature;</p>
<pre><code>// Read temperature registers
temp_msb = (int8_t)DS1722_ReadRegister(DS1722_REG_TEMP_MSB);
temp_lsb = DS1722_ReadRegister(DS1722_REG_TEMP_LSB);

// Calculate temperature based on resolution
// LSB bits represent fractional part: bit7=0.5, bit6=0.25, bit5=0.125, etc.
temperature = (float)temp_msb;
temperature += (temp_lsb &gt;&gt; 5) * 0.125f;  // Upper 3 bits for 12-bit resolution

return temperature;</code></pre>
<p>}</p>
<p>/** * Initialize and read temperature from DS1722 * Example usage function */ float DS1722_GetTemperature(void) { static uint8_t initialized = 0;</p>
<pre><code>// Initialize SPI and sensor on first call
if (!initialized) {
    DS1722_SPI_Init();
    delay_ms(10);  // Wait for sensor to power up
    DS1722_Configure(DS1722_CONFIG_RES_12BIT);  // 12-bit resolution
    delay_ms(250); // Wait for first conversion (max 240ms for 12-bit)
    initialized = 1;
}

// Read and return temperature
return DS1722_ReadTemperature();</code></pre>
<p>}</p>
<p>Here are a few ideas of on what you might comment on:</p>
<p>I think the Quality of both was really good. I liked the HTML page, however just based on glance without running I can tell that the code for the SPI and the sensor was wrong. This is due to the code saying that the sensor is active low, meaning it probably did not read the datasheet. This is what I noticed at first glance, and because you cannot switch the sensors hardware around, this code is faulty. Compared to my setup it was fine. My had the same idea hwoever it was just written completely differently. The SPI setup was around the same however. The LLLM chose an input clock of 5MHZ which is an acceptable range for the sensor, which can have inputs up to 10MHZ. The LLM works well for creating the initial idea and overall structure. But its code is faulty due to it not reading the datasheet correctly.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/Swayngee\.github\.io\/e155-lab1\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>