//Drake Gonzales
//drgonzales@g.hmc.edu
//This Module is my main file for lab4
//9/28/25

// Pitch in Hz, duration in ms
#include "STM32L432KC_TIM16.h"
#include "STM32L432KC_TIM7.h"
#include "STM32L432KC_GPIO.h"
#include "STM32L432KC_FLASH.h"

const int notes[][2] = {
{659,	125},
{623,	125},
{659,	125},
{623,	125},
{659,	125},
{494,	125},
{587,	125},
{523,	125},
{440,	250},
{  0,	125},
{262,	125},
{330,	125},
{440,	125},
{494,	250},
{  0,	125},
{330,	125},
{416,	125},
{494,	125},
{523,	250},
{  0,	125},
{330,	125},
{659,	125},
{623,	125},
{659,	125},
{623,	125},
{659,	125},
{494,	125},
{587,	125},
{523,	125},
{440,	250},
{  0,	125},
{262,	125},
{330,	125},
{440,	125},
{494,	250},
{  0,	125},
{330,	125},
{523,	125},
{494,	125},
{440,	250},
{  0,	125},
{494,	125},
{523,	125},
{587,	125},
{659,	375},
{392,	125},
{699,	125},
{659,	125},
{587,	375},
{349,	125},
{659,	125},
{587,	125},
{523,	375},
{330,	125},
{587,	125},
{523,	125},
{494,	250},
{  0,	125},
{330,	125},
{659,	125},
{  0,	250},
{659,	125},
{1319,	125},
{  0,	250},
{623,	125},
{659,	125},
{  0,	250},
{623,	125},
{659,	125},
{623,	125},
{659,	125},
{623,	125},
{659,	125},
{494,	125},
{587,	125},
{523,	125},
{440,	250},
{  0,	125},
{262,	125},
{330,	125},
{440,	125},
{494,	250},
{  0,	125},
{330,	125},
{416,	125},
{494,	125},
{523,	250},
{  0,	125},
{330,	125},
{659,	125},
{623,	125},
{659,	125},
{623,	125},
{659,	125},
{494,	125},
{587,	125},
{523,	125},
{440,	250},
{  0,	125},
{262,	125},
{330,	125},
{440,	125},
{494,	250},
{  0,	125},
{330,	125},
{523,	125},
{494,	125},
{440,	500},
{  0,	0}};



// thunderstruck chords
const int thunder[][2] = {
    {494, 132},   // B4
    {587, 132},   // D5
    {659, 132},   // E5
    {740, 132},   // F#5
    {494, 132},   // B4
    {659, 132},   // E5
    {880, 132},   // A5
    {740, 132},   // F#5
    {494, 150},   // B4
    {587, 150},   // D5
    {659, 150},   // E5
    {740, 150},   // F#5
    {494, 150},   // B4
    {659, 150},   // E5
    {880, 150},   // A5
    {740, 150},   // F#5
    {494, 150},   // B4
    {587, 150},   // D5
    {659, 150},   // E5
    {740, 150},   // F#5
    {494, 150},   // B4
    {659, 150},   // E5
    {880, 150},   // A5
    {740, 150},   // F#5
    {494, 300},   // B4
    {587, 300},   // D5
    {659, 300},   // E5
    {740, 300},   // F#5
    {494, 300},   // B4
    {659, 300},   // E5
    {880, 300},   // A5
    {740, 300},   // F#5
    {0 ,0}
};



int main(void) {
// Configure flash to add waitstates to avoid timing errors
configureFlash();

// Setup the PLL and switch clock source to the PLL
config16();
configtim7();

pinMode(6, GPIO_ALT); // set pin and pin func
GPIO->AFRL &= ~(0xF << 24);    // init pin6 and wire to tim
GPIO->AFRL |= (14 << 24);

// for Fur Elise
for (int i = 0; notes[i][1]; i++) {
PWM(notes[i][0]);
delay(notes[i][1]);
}

// for thunderstruck
for (int i = 0; thunder[i][1]; i++) {
PWM(thunder[i][0]);
delay(thunder[i][1]);
}
TIM16->CCER &= ~1;// disable tim
TIM16->CR1 &= ~1; 
while(1){
PWM(0);
}

     
}
